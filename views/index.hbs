<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <meta name="description" content="" />
  <meta name="author" content="" />
  <!--[if IE]>
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <![endif]-->
  <title>SIRIMIRI ADMIN</title>
  <!-- CHART -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.min.js"></script>
  <!-- BOOTSTRAP CORE STYLE  -->
  <link href="stylesheets/bootstrap.css" rel="stylesheet" />
  <!-- FONT AWESOME STYLE  -->
  <link href="stylesheets/font-awesome.css" rel="stylesheet" />
  <!-- CUSTOM STYLE  -->
  <link href="stylesheets/style.css" rel="stylesheet" />
  <!-- GOOGLE FONT -->
  <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css' />
  <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>


  <script src="https://code.jquery.com/jquery-1.9.1.min.js"></script>
  <script src="javascripts/chart.js"></script>

</head>

<body>

  <!-- MENU SECTION END-->
  <div class="content-wrapper">
    <div class="container">
      <div class="row pad-botm col-md-12">
        <div class="row">
          <div class="col-md-2">
            <h4 class="text-line">Thời gian: </h4>
          </div>
          <div class="col-md-10">
            <div id="selector" class="btn-group" role="group" aria-label="Basic example">
              <button type="button" class="btn btn-outline-primary active" value="0">Hôm nay </button>
              <button type="button" class="btn btn-outline-primary" value="1">Hôm qua</button>
              <button type="button" class="btn btn-outline-primary" value="3">3 ngày trước</button>
              <button type="button" class="btn btn-outline-primary" value="7">1 tuần trước</button>
              <button type="button" class="btn btn-outline-primary" value="14">2 tuần trước</button>
              <button type="button" class="btn btn-outline-primary" value="31">1 tháng trước</button>
              <button type="button" class="btn btn-outline-primary" value="365">1 năm trước</button>
            </div>
          </div>
        </div>
        <br />
      </div>
      <h4 class="header-line">THỐNG KÊ TỔNG THU - SL ĐƠN HÀNG - SL NGƯỜI DÙNG</h4>
      <div class="row">
        <div class="col-md-4 col-sm-4 col-xs-6">
          <div class="alert alert-info back-widget-set text-center">
            <img src="images/revenue.png" class="img-statistic" />
            <h3>Tổng thu</h3>
            <h4 id="info-totalprice-order"></h4>
          </div>
        </div>
        <div class="col-md-4 col-sm-4 col-xs-6">
          <div class="alert alert-warning back-widget-set text-center">
            <img src="images/order.png" class="img-statistic" />
            <h3>Đơn hàng</h3>
            <h4 id="info-count-order"></h4>
          </div>
        </div>
        <div class="col-md-4 col-sm-4 col-xs-6">
          <div class="alert alert-success back-widget-set text-center">
            <img src="images/customer.png" class="img-statistic" />
            <h3>Người dùng</h3>
            <h4 id="info-count-user"></h4>
          </div>
        </div>
      </div>

      <h4 class="header-line">THỐNG KÊ SẢN PHẨM ĐÃ BÁN</h4>
      <div class="row">
        <div class="col-md-4 col-sm-4 col-xs-12">
          <div class="panel">
            <div class="panel-heading header-panel">
              Hình ảnh 10 sản phẩm bán chạy nhất
            </div>
            <div class="panel-body text-center top-10-img" id="image-sold-product">
            <img src = "image/mice.jpg">
            <img src = "image/xs.jpg">
            <img src = "image/rz.jpg">
            <img src = "image/mg.jpg">
            </div>

          </div>
        </div>
        <div class="col-md-8 col-sm-8 col-xs-12">
          <div class="panel">
            <div class="panel-heading header-panel">
              Top 10 sản phẩm bán chạy nhất
            </div>
            <div class="panel-body">
              <div class="table-responsive">
                <table class="table table-striped table-bordered table-hover">
                  <thead>
                    <tr>
                      <th>STT</th>
                      <th>Tên sản phẩm</th>
                      <th>Giá bán (1 đơn vị)</th>
                      <th>Số lượng bán ra</th>
                    </tr>
                    <tr>
                      <th>1</th>
                      <th>Chuột gaming razer</th>
                      <th>650.000</th>
                      <th>250</th>
                    </tr>
                    <tr>
                      <th>2</th>
                      <th>Iphone 11 Pro 128GB</th>
                      <th>38.000.000</th>
                      <th>240</th>
                    </tr>
                    <tr>
                      <th>3</th>
                      <th>Airpod</th>
                      <th>5.800.000</th>
                      <th>210</th>
                    </tr>
                    <tr>
                      <th>4</th>
                      <th>Iphone 11 ProMax</th>
                      <th>40.000.000</th>
                      <th>150</th>
                    </tr>
                    <tr>
                      <th>5</th>
                      <th>Bàn phím cơ lofree</th>
                      <th>2.500.000</th>
                      <th>100</th>
                    </tr>
                  </thead>
                  <tbody id="list-sold-product">

                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

      </div>
      <!-- CHART -->
      <h4 class="header-line">BIỂU ĐỒ THỐNG KÊ SỐ LƯỢNG SẢN PHẨM ĐÃ BÁN THEO DANH MỤC</h4>
     <!-- <div class="row"><iframe class="chartjs-hidden-iframe" tabindex="-1"
          style="display: block; overflow: hidden; border: 0px; margin: 0px; top: 0px; left: 0px; bottom: 0px; right: 0px; height: 100%; width: 100%; position: absolute; pointer-events: none; z-index: -1;"></iframe>
        <canvas id="myChart" width="2280" height="1140" style="display: block; height: 570px; width: 1140px;"></canvas>
      </div>
      <script type="text/javascript">
      google.charts.load('current', {'packages':['corechart']});
        google.charts.setOnLoadCallback(drawChart);</script>
        var data = google.visualization.arrayToDataTable([
      ['Samsung', 3],
      ['iPhone', 4],
      ['Oppo', 2],
      ['Sony', 1],   
]);
      var options = {'title':'SmartPhone', 'width':400, 'height':300};
var chart = new google.visualization.PieChart(document.getElementById('piechart'));
  chart.draw(data, options);
}</script>-->
    <canvas id="pieChart"></canvas>
    </div>
  </div>

  <!-- FOOTER SECTION END-->
  <!-- JAVASCRIPT FILES PLACED AT THE BOTTOM TO REDUCE THE LOADING TIME  -->
  <!-- CORE JQUERY  -->
  <script src="javascripts/jquery-1.10.2.js"></script>
  <script>
    (function (global) {
      if (typeof (global) === "undefined") {
        throw new Error("window is undefined");
      }

      var _hash = "!";
      var noBackPlease = function () {
        global.location.href += "#";

        // making sure we have the fruit available for juice....
        // 50 milliseconds for just once do not cost much (^__^)
        global.setTimeout(function () {
          global.location.href += "!";
        }, 50);
      };

      // Earlier we had setInerval here....
      global.onhashchange = function () {
        if (global.location.hash !== _hash) {
          global.location.hash = _hash;
        }
      };

      global.onload = function () {

        noBackPlease();

        // disables backspace on page except on input fields and textarea..
        document.body.onkeydown = function (e) {
          var elm = e.target.nodeName.toLowerCase();
          if (e.which === 8 && (elm !== 'input' && elm !== 'textarea')) {
            e.preventDefault();
          }
          // stopping event bubbling up the DOM tree..
          e.stopPropagation();
        };

      };

    })(window);
  </script>

  <!-- BOOTSTRAP SCRIPTS  -->
  <script src="javascripts/bootstrap.js"></script>
  <!-- CUSTOM SCRIPTS  -->
  <script src="javascripts/custom.js"></script>
  <script>
    $('#selector button').click(function () {
      $(this).addClass('active').siblings().removeClass('active');
      // TODO: insert whatever you want to do with $(this) here
      var val = this.value;
      var valNumber = parseInt(val, 10);
      switch (valNumber) {
        case 0:
          var date = new Date();
          date.setHours(0, 0, 0, 0);
          var update = date.getTime();
          console.log("today", update)
          setUI(update)
          break;
        case 1:
          var date = new Date();
          date.setHours(0, 0, 0, 0);
          var update = date.setDate(date.getDate() - 1);
          setUI(update)
          break;
        case 3:
          var date = new Date();
          date.setHours(0, 0, 0, 0);
          var update = date.setDate(date.getDate() - 3);
          setUI(update)
          break;
        case 7:
          var date = new Date();
          date.setHours(0, 0, 0, 0);
          var update = date.setDate(date.getDate() - 7);
          setUI(update)
          break;
        case 14:
          var date = new Date();
          date.setHours(0, 0, 0, 0);
          var update = date.setDate(date.getDate() - 14);
          setUI(update)
          break;
        case 31:
          var date = new Date();
          date.setHours(0, 0, 0, 0);
          var update = date.setDate(date.getDate() - 31);
          setUI(update)
          break;
        case 365:
          var date = new Date();
          date.setHours(0, 0, 0, 0);
          var update = date.setDate(date.getDate() - 365);
          setUI(update)
          break;

      }

    });
    var setUI = function (update) {
      //refesh
      $("#list-sold-product").empty();
      $("#image-sold-product").empty();
      //set info list-sold-product
      var url = "/home/productSold/" + update;
      console.log(url);
      $.get(url)
        .then(data => {
          console.log(data);
          for (var i = 0; i < data.length; i++) {
            if (i === 10) break;
            var e = data[i];
            var tr = document.createElement("tr");
            var td0 = document.createElement("td");
            td0.innerHTML = i;
            var td1 = document.createElement("td");
            td1.innerHTML = e.name;
            var td2 = document.createElement("td");
            var price = e.price.toLocaleString('it-IT', { style: 'currency', currency: 'VND' });
            td2.innerHTML = price;
            var td3 = document.createElement("td");
            td3.innerHTML = e.qty;
            tr.append(td0);
            tr.append(td1);
            tr.append(td2);
            tr.append(td3);
            $("#list-sold-product").append(tr);

            var x = document.createElement("IMG");
            var src = e.image;
            x.setAttribute("src", src);
            x.setAttribute("alt", "");
            $("#image-sold-product").append(x);
          }
        })

      //Set info order
      var url1 = "/home/orderSuccess/" + update;
      console.log(url1);
      $.get(url1)
        .then(data => {
          var totalPrice = 0;
          data.forEach(function (e) {
            var status = parseInt(e.status,10);
            if(status == 4){
              totalPrice = totalPrice + e.products.totalPrice;
            }
            console.log(status);
            //if(pareInt(e.status,10)==4)
          })
          var countOrders = data.length;
          console.log('CountOrder: ', countOrders);
          totalPrice = totalPrice.toLocaleString('it-IT', { style: 'currency', currency: 'VND' });
          $('#info-count-order').text(countOrders);
          $('#info-totalprice-order').text(totalPrice)
        })

      //Set info number of user resgister
      var url2 = "/home/userRegister/" + update;
      console.log(url2);
      $.get(url2)
        .then(data => {
          var totalPrice = 0;

          var countUsers = data.length;
          console.log("contUsers", countUsers);
          $('#info-count-user').text(countUsers);
        })

    };
  </script>
</body>

</html>